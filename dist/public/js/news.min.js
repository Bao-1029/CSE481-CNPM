import{createElement,createGroupItem,mandatory,utf8Decode}from"./helpers.min.js";const loading=document.querySelector(".main__icon-loading");let load_num=0,isFirstLoad=!0;async function initView(){const data=await getNews("all");let headlines=data.headlines;const featuredNews=headlines.shift(),relatedNews=headlines,otherNews=data.news,main=document.querySelector(".main"),fragment=new DocumentFragment;fragment.appendChild(createHotlines(featuredNews,relatedNews)),fragment.appendChild(createOtherNews(otherNews));const frag_recent=fragment.querySelector(".main__recent-news"),btn_more=createElement("button",{class:"main__more",html:"<span>Xem thêm</span>",events:{click:loadOtherNews.bind(this,frag_recent)}});fragment.appendChild(btn_more),loading.style.display="none",main.insertBefore(fragment,loading)}function createHotlines(featuredData=mandatory(),relatedData=mandatory()){const featured_news=createFeaturedNews(featuredData),related_news=createRelatedNews(relatedData),main=createElement("div",{class:"main__news",html:'<h2 class="main__title">Bài viết hàng đầu</h2>',nodes:[featured_news,related_news]});return main}function createFeaturedNews(data=mandatory()){const{title:title,source:source,link:link,imgUri:imgUri}=data,img=createElement("a",{href:link,html:`<img src="${imgUri}" alt="">`}),p=createElement("p",{html:`<a href="${link}">${utf8Decode(title)}</a>`}),span=createElement("span",{class:"main__source",text:utf8Decode(source)}),news=createElement("div",{class:"main__featured-news",nodes:[img,p,span]});return news}function createRelatedNews(data=mandatory()){return createGroupItem("div",{class:"main__related-news"},data,(function(item){const{title:title,source:source,link:href}=item,p=createElement("p",{html:`<a href="${href}">${utf8Decode(title)}</a>`}),span=createElement("span",{class:"main__source",text:utf8Decode(source)}),div=createElement("div",{class:"main__related-content",nodes:[p,span]});return div}))}function createOtherNews(data=mandatory()){if(isFirstLoad)return isFirstLoad=!1,createGroupItem("div",{class:"main__recent-news"},data,createOtherNewsItem);{const fragment=new DocumentFragment;return data.forEach(d=>{const row=createOtherNewsItem(d);fragment.appendChild(row)}),fragment}}function createOtherNewsItem(item){const{title:title,source:source,link:link,imgUri:imgUri}=item,img=createElement("div",{class:"main__recent-img",html:`<a href="${link}"><img src="${imgUri}" alt=""></a>`}),p=createElement("p",{html:`<a href="${link}">${utf8Decode(title)}</a>`}),span=createElement("span",{class:"main__source",text:utf8Decode(source)}),text=createElement("span",{class:"main__recent-text",nodes:[p,span]}),div=createElement("div",{class:"main__recent-content",nodes:[img,text]});return div}function loadOtherNews(node){const this_btn=event.target;loading.style.display="block",this_btn.style.display="none",getNews(load_num).then(d=>{if(0==d.length)return this_btn.remove(),void(loading.style.display="none");node.appendChild(createOtherNews(d)),loading.style.display="none",this_btn.style.display="block"}),load_num++}function getNews(param){return fetch(`/api/news/${param}`,{method:"GET"}).then(response=>{if(200===response.status)return response.json();console.log(`Check your internet connection\nerror code: ${response.status}`)}).then(json=>json.data).catch(err=>console.log("Request failed",err))}initView();